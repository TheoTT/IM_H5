function MediaStreamRecorder(e){if(!e)throw"MediaStream is mandatory.";this.start=function(o){var i;"undefined"!=typeof MediaRecorder?i=MediaRecorderWrapper:(IsChrome||IsOpera||IsEdge)&&(-1!==this.mimeType.indexOf("video")?i=WhammyRecorder:-1!==this.mimeType.indexOf("audio")&&(i=StereoAudioRecorder)),"image/gif"===this.mimeType&&(i=GifRecorder),"audio/wav"!==this.mimeType&&"audio/pcm"!==this.mimeType||(i=StereoAudioRecorder),this.recorderType&&(i=this.recorderType),t=new i(e),t.blobs=[];var r=this;t.ondataavailable=function(e){t.blobs.push(e),r.ondataavailable(e)},t.onstop=this.onstop,t.onStartedDrawingNonBlankFrames=this.onStartedDrawingNonBlankFrames,t=mergeProps(t,this),t.start(o)},this.onStartedDrawingNonBlankFrames=function(){},this.clearOldRecordedFrames=function(){t&&t.clearOldRecordedFrames()},this.stop=function(){t&&t.stop()},this.ondataavailable=function(e){console.log("ondataavailable..",e)},this.onstop=function(e){console.warn("stopped..",e)},this.save=function(e,o){if(!e){if(!t)return;return void ConcatenateBlobs(t.blobs,t.blobs[0].type,function(e){invokeSaveAsDialog(e)})}invokeSaveAsDialog(e,o)},this.pause=function(){t&&(t.pause(),console.log("Paused recording.",this.mimeType||t.mimeType))},this.resume=function(){t&&(t.resume(),console.log("Resumed recording.",this.mimeType||t.mimeType))},this.recorderType=null,this.mimeType="video/webm",this.disableLogs=!1;var t}function MultiStreamRecorder(e){function t(){n.audioContext=new AudioContext;var t=[],o=0;if(e.forEach(function(e){e.getAudioTracks().length&&(o++,t.push(n.audioContext.createMediaStreamSource(e)))}),o)return n.audioDestination=n.audioContext.createMediaStreamDestination(),t.forEach(function(e){e.connect(n.audioDestination)}),n.audioDestination.stream}function o(){e.forEach(function(e){if(e.getVideoTracks().length){var t=i(e);t.width=n.video.width,t.height=n.video.height,s.push(t)}});var t;"captureStream"in d?t=d.captureStream():"mozCaptureStream"in d?t=d.mozCaptureStream():n.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var o=new MediaStream;return t.getVideoTracks().forEach(function(e){o.addTrack(e)}),o}function i(e){var t=document.createElement("video");return t.src=URL.createObjectURL(e),t.play(),t}function r(){if(!c){var e=s.length;d.width=e>1?2*s[0].width:s[0].width,d.height=e>2?2*s[0].height:s[0].height,s.forEach(function(t,o){if(1===e)return void u.drawImage(t,0,0,t.width,t.height);if(2===e){var i=0,r=0;return 1===o&&(i=t.width),void u.drawImage(t,i,r,t.width,t.height)}if(3===e){var i=0,r=0;return 1===o&&(i=t.width),2===o&&(r=t.height),void u.drawImage(t,i,r,t.width,t.height)}if(4===e){var i=0,r=0;return 1===o&&(i=t.width),2===o&&(r=t.height),3===o&&(i=t.width,r=t.height),void u.drawImage(t,i,r,t.width,t.height)}}),setTimeout(r,n.frameInterval)}}e instanceof MediaStream&&(e=[e]);var n=this;this.mimeType||(this.mimeType="video/webm"),this.frameInterval||(this.frameInterval=10),this.video||(this.video={}),this.video.width||(this.video.width=360),this.video.height||(this.video.height=240),this.start=function(e){c=!1;var i=o(),s=t();s&&s.getAudioTracks().forEach(function(e){i.addTrack(e)}),n.previewStream&&"function"==typeof n.previewStream&&n.previewStream(i),a=new MediaStreamRecorder(i);for(var d in n)"function"!=typeof n[d]&&(a[d]=n[d]);a.ondataavailable=function(e){n.ondataavailable(e)},a.onstop=n.onstop,r(),a.start(e)},this.stop=function(e){c=!0,a&&a.stop(function(t){e(t)})};var a,s=[],c=!1,d=document.createElement("canvas"),u=d.getContext("2d");d.style="opacity:0;position:absolute;z-index:-1;top: -100000000;left:-1000000000;",(document.body||document.documentElement).appendChild(d),this.pause=function(){a&&a.pause()},this.resume=function(){a&&a.resume()},this.clearRecordedData=function(){s=[],u.clearRect(0,0,d.width,d.height),c=!1,(a=null)&&a.clearRecordedData()},this.addStream=function(t){if(t instanceof Array&&t.length)return void t.forEach(this.addStream);if(e.push(t),a){if(t.getVideoTracks().length){var o=i(t);o.width=n.video.width,o.height=n.video.height,s.push(o)}if(t.getAudioTracks().length&&n.audioContext){n.audioContext.createMediaStreamSource(t).connect(n.audioDestination)}}},this.ondataavailable=function(e){n.disableLogs||console.log("ondataavailable",e)},this.onstop=function(){}}function mergeProps(e,t){for(var o in t)"function"!=typeof t[o]&&(e[o]=t[o]);return e}function dropFirstFrame(e){return e.shift(),e}function invokeSaveAsDialog(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(e){}var o=(e.type||"video/webm").split("/")[1];if(t&&-1!==t.indexOf(".")){var i=t.split(".");t=i[0],o=i[1]}var r=(t||Math.round(9999999999*Math.random())+888888888)+"."+o;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,r);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(e,r);var n=document.createElement("a");n.href=URL.createObjectURL(e),n.target="_blank",n.download=r,navigator.mozGetUserMedia&&(n.onclick=function(){(document.body||document.documentElement).removeChild(n)},(document.body||document.documentElement).appendChild(n));var a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n.dispatchEvent(a),navigator.mozGetUserMedia||URL.revokeObjectURL(n.href)}function bytesToSize(e){var t=["Bytes","KB","MB","GB","TB"];if(0===e)return"0 Bytes";var o=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,o)).toPrecision(3)+" "+t[o]}function isMediaRecorderCompatible(){var e=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t=!!window.chrome&&!e;if(void 0!==window.InstallTrigger)return!0;if(!t)return!1;var o,i,r=(navigator.appVersion,navigator.userAgent),n=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10);return t&&(o=r.indexOf("Chrome"),n=r.substring(o+7)),-1!==(i=n.indexOf(";"))&&(n=n.substring(0,i)),-1!==(i=n.indexOf(" "))&&(n=n.substring(0,i)),a=parseInt(""+n,10),isNaN(a)&&(n=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10)),a>=49}function MediaRecorderWrapper(e){function t(){if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}var o=this;this.start=function(t,r){if(o.mimeType||(o.mimeType="video/webm"),-1!==o.mimeType.indexOf("audio")&&e.getVideoTracks().length&&e.getAudioTracks().length){var n;navigator.mozGetUserMedia?(n=new MediaStream,n.addTrack(e.getAudioTracks()[0])):n=new MediaStream(e.getAudioTracks()),e=n}-1!==o.mimeType.indexOf("audio")&&(o.mimeType=IsChrome?"audio/webm":"audio/ogg"),o.dontFireOnDataAvailableEvent=!1;var a={mimeType:o.mimeType};o.disableLogs||r||console.log("Passing following params over MediaRecorder API.",a),i&&(i=null),IsChrome&&!isMediaRecorderCompatible()&&(a="video/vp8");try{i=new MediaRecorder(e,a)}catch(t){i=new MediaRecorder(e)}"canRecordMimeType"in i&&!1===i.canRecordMimeType(o.mimeType)&&(o.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",o.mimeType)),i.ignoreMutedMedia=o.ignoreMutedMedia||!1;var s=!1;i.ondataavailable=function(e){if(!o.dontFireOnDataAvailableEvent&&e.data&&e.data.size&&!(e.data.size<26800)&&!s){s=!0;var r=o.getNativeBlob?e.data:new Blob([e.data],{type:o.mimeType||"video/webm"});o.ondataavailable(r),o.dontFireOnDataAvailableEvent=!0,i&&"recording"===i.state&&i.stop(),i=null,o.start(t,"__disableLogs")}},i.onerror=function(e){o.disableLogs||("InvalidState"===e.name?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),i&&"inactive"!==i.state&&"stopped"!==i.state&&i.stop()};try{i.start(36e5)}catch(e){i=null}setTimeout(function(){i&&"recording"===i.state&&i.requestData()},t)},this.stop=function(e){i&&"recording"===i.state&&(i.requestData(),setTimeout(function(){o.dontFireOnDataAvailableEvent=!0,i&&"recording"===i.state&&i.stop(),i=null,o.onstop()},2e3))},this.pause=function(){i&&"recording"===i.state&&i.pause()},this.ondataavailable=function(e){console.log("recorded-blob",e)},this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=!1;var e=o.disableLogs;return o.disableLogs=!0,this.record(),void(o.disableLogs=e)}i&&"paused"===i.state&&i.resume()},this.clearRecordedData=function(){i&&(this.pause(),this.dontFireOnDataAvailableEvent=!0,this.stop())},this.onstop=function(){};var i;!function e(){if(i)return!1===t()?void o.stop():void setTimeout(e,1e3)}()}function StereoAudioRecorder(e){this.start=function(i){i=i||1e3,t=new StereoAudioRecorderHelper(e,this),t.record(),o=setInterval(function(){t.requestData()},i)},this.stop=function(){t&&(t.stop(),clearTimeout(o),this.onstop())},this.pause=function(){t&&t.pause()},this.resume=function(){t&&t.resume()},this.ondataavailable=function(){},this.onstop=function(){};var t,o}function StereoAudioRecorderHelper(e,t){function o(e,t){for(var o=e.length+t.length,i=new Float32Array(o),r=0,n=0;n<o;)i[n++]=e[r],i[n++]=t[r],r++;return i}function i(e,t){for(var o=new Float32Array(t),i=0,r=e.length,n=0;n<r;n++){var a=e[n];o.set(a,i),i+=a.length}return o}function r(e,t,o){for(var i=o.length,r=0;r<i;r++)e.setUint8(t+r,o.charCodeAt(r))}function n(e){for(var t=e.length,o=new Int16Array(t);t--;)o[t]=65535*e[t];return o.buffer}var a=44100;ObjectStore.AudioContextConstructor||(ObjectStore.AudioContextConstructor=new ObjectStore.AudioContext),a=ObjectStore.AudioContextConstructor.sampleRate;var s,c,d,u,l=[],g=[],m=!1,h=0,f=t.sampleRate||a,p=t.mimeType||"audio/wav",y=p.indexOf("audio/pcm")>-1,M=t.audioChannels||2;this.record=function(){m=!0,l.length=g.length=0,h=0},this.requestData=function(){if(!b){if(0===h)return void(I=!1);I=!0;var e=l.slice(0),a=g.slice(0),s=h;l.length=g.length=[],h=0,I=!1;var c=i(e,s),d=c;if(2===M){d=o(c,i(a,s))}if(y){var u=new Blob([n(d)],{type:"audio/pcm"});return console.debug("audio recorded blob size:",bytesToSize(u.size)),void t.ondataavailable(u)}var m=new ArrayBuffer(44+2*d.length),p=new DataView(m);r(p,0,"RIFF"),p.setUint32(4,44+2*d.length-8,!0),r(p,8,"WAVE"),r(p,12,"fmt "),p.setUint32(16,16,!0),p.setUint16(20,1,!0),p.setUint16(22,M,!0),p.setUint32(24,f,!0),p.setUint32(28,f*M*2,!0),p.setUint16(32,2*M,!0),p.setUint16(34,16,!0),r(p,36,"data"),p.setUint32(40,2*d.length,!0);for(var v=d.length,S=44,_=0;_<v;_++)p.setInt16(S,32767*d[_],!0),S+=2;var u=new Blob([p],{type:"audio/wav"});console.debug("audio recorded blob size:",bytesToSize(u.size)),t.ondataavailable(u)}},this.stop=function(){m=!1,this.requestData(),d.disconnect(),this.onstop()};var u=ObjectStore.AudioContextConstructor;ObjectStore.VolumeGainNode=u.createGain();var c=ObjectStore.VolumeGainNode;ObjectStore.AudioInput=u.createMediaStreamSource(e);var d=ObjectStore.AudioInput;d.connect(c);var v=t.bufferSize||2048;if(0===t.bufferSize&&(v=0),u.createJavaScriptNode)s=u.createJavaScriptNode(v,M,M);else{if(!u.createScriptProcessor)throw"WebAudio API has no support on this browser.";s=u.createScriptProcessor(v,M,M)}v=s.bufferSize,console.debug("using audio buffer-size:",v);var I=!1;window.scriptprocessornode=s,1===M&&console.debug("All right-channels are skipped.");var b=!1;this.pause=function(){b=!0},this.resume=function(){b=!1},this.onstop=function(){},s.onaudioprocess=function(e){if(m&&!I&&!b){var t=e.inputBuffer.getChannelData(0);if(l.push(new Float32Array(t)),2===M){var o=e.inputBuffer.getChannelData(1);g.push(new Float32Array(o))}h+=v}},c.connect(s),s.connect(u.destination)}function WhammyRecorder(e){this.start=function(i){i=i||1e3,t=new WhammyRecorderHelper(e,this);for(var r in this)"function"!=typeof this[r]&&(t[r]=this[r]);t.record(),o=setInterval(function(){t.requestData()},i)},this.stop=function(){t&&(t.stop(),clearTimeout(o),this.onstop())},this.onstop=function(){},this.clearOldRecordedFrames=function(){t&&t.clearOldRecordedFrames()},this.pause=function(){t&&t.pause()},this.resume=function(){t&&t.resume()},this.ondataavailable=function(){};var t,o}function WhammyRecorderHelper(e,t){function o(){if(h)return d=(new Date).getTime(),void setTimeout(o,500);if(!s){if(n)return setTimeout(o,100);var e=(new Date).getTime()-d;if(!e)return o();d=(new Date).getTime(),!m.isHTMLObject&&c.paused&&c.play(),g.drawImage(c,0,0,l.width,l.height),s||u.frames.push({duration:e,image:l.toDataURL("image/webp")}),a||i(u.frames[u.frames.length-1])||(a=!0,t.onStartedDrawingNonBlankFrames()),setTimeout(o,10)}}function i(e,t,o){var i=document.createElement("canvas");i.width=l.width,i.height=l.height;var r,n,a,s=i.getContext("2d"),c={r:0,g:0,b:0},d=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),u=t&&t>=0&&t<=1?t:0,g=o&&o>=0&&o<=1?o:0,m=new Image;m.src=e.image,s.drawImage(m,0,0,l.width,l.height);var h=s.getImageData(0,0,l.width,l.height);r=0,n=h.data.length,a=h.data.length/4;for(var f=0;f<n;f+=4){var p={r:h.data[f],g:h.data[f+1],b:h.data[f+2]};Math.sqrt(Math.pow(p.r-c.r,2)+Math.pow(p.g-c.g,2)+Math.pow(p.b-c.b,2))<=d*u&&r++}return!(a-r<=a*g)}function r(e,t,o,i){var r=document.createElement("canvas");r.width=l.width,r.height=l.height;for(var n=r.getContext("2d"),a=[],s=-1===t,c=t&&t>0&&t<=e.length?t:e.length,d={r:0,g:0,b:0},u=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),g=o&&o>=0&&o<=1?o:0,m=i&&i>=0&&i<=1?i:0,h=!1,f=0;f<c;f++){var p,y,M;if(!h){var v=new Image;v.src=e[f].image,n.drawImage(v,0,0,l.width,l.height);var I=n.getImageData(0,0,l.width,l.height);p=0,y=I.data.length,M=I.data.length/4;for(var b=0;b<y;b+=4){var S={r:I.data[b],g:I.data[b+1],b:I.data[b+2]};Math.sqrt(Math.pow(S.r-d.r,2)+Math.pow(S.g-d.g,2)+Math.pow(S.b-d.b,2))<=u*g&&p++}}!h&&M-p<=M*m||(s&&(h=!0),a.push(e[f]))}return a=a.concat(e.slice(c)),a.length<=0&&a.push(e[e.length-1]),a}this.record=function(i){this.width||(this.width=320),this.height||(this.height=240),this.video&&this.video instanceof HTMLVideoElement&&(this.width||(this.width=c.videoWidth||c.clientWidth||320),this.height||(this.height=c.videoHeight||c.clientHeight||240)),this.video||(this.video={width:this.width,height:this.height}),this.canvas&&this.canvas.width&&this.canvas.height||(this.canvas={width:this.width,height:this.height}),l.width=this.canvas.width,l.height=this.canvas.height,this.video&&this.video instanceof HTMLVideoElement?(this.isHTMLObject=!0,c=this.video.cloneNode()):(c=document.createElement("video"),c.src=URL.createObjectURL(e),c.width=this.video.width,c.height=this.video.height),c.muted=!0,c.play(),d=(new Date).getTime(),u=new Whammy.Video(t.speed,t.quality),console.log("canvas resolutions",l.width,"*",l.height),console.log("video width/height",c.width||l.width,"*",c.height||l.height),o()},this.clearOldRecordedFrames=function(){u.frames=[]};var n=!1;this.requestData=function(){if(!h){if(!u.frames.length)return void(n=!1);n=!0;var e=u.frames.slice(0);u.frames=r(e,-1),u.compile(function(e){t.ondataavailable(e),console.debug("video recorded blob size:",bytesToSize(e.size))}),u.frames=[],n=!1}};var a=!1,s=!1;this.stop=function(){s=!0,this.requestData(),this.onstop()};var c,d,u,l=document.createElement("canvas"),g=l.getContext("2d"),m=this,h=!1;this.pause=function(){h=!0},this.resume=function(){h=!1},this.onstop=function(){}}function GifRecorder(e){function t(){c=Date.now();var e=new Blob([new Uint8Array(u.stream().bin)],{type:"image/gif"});i.ondataavailable(e),u.stream().bin=[]}if("undefined"==typeof GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";this.start=function(e){function i(e){if(o)return void setTimeout(i,500,e);g=requestAnimationFrame(i),void 0===typeof d&&(d=e),e-d<90||(a.paused&&a.play(),n.drawImage(a,0,0,c,m),u.addFrame(n),d=e)}e=e||1e3;var c=this.videoWidth||320,m=this.videoHeight||240;r.width=a.width=c,r.height=a.height=m,u=new GIFEncoder,u.setRepeat(0),u.setDelay(this.frameRate||this.speed||200),u.setQuality(this.quality||1),u.start(),s=Date.now(),g=requestAnimationFrame(i),l=setTimeout(t,e)},this.stop=function(){g&&(cancelAnimationFrame(g),clearTimeout(l),t(),this.onstop())},this.onstop=function(){};var o=!1;this.pause=function(){o=!0},this.resume=function(){o=!1},this.ondataavailable=function(){},this.onstop=function(){};var i=this,r=document.createElement("canvas"),n=r.getContext("2d"),a=document.createElement("video");a.muted=!0,a.autoplay=!0,a.src=URL.createObjectURL(e),a.play();var s,c,d,u,l,g=null}void 0!==MediaStreamRecorder&&(MediaStreamRecorder.MultiStreamRecorder=MultiStreamRecorder);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(e){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},e.window=global),"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var AudioContext=window.AudioContext;void 0===AudioContext&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext)),"undefined"==typeof window&&(window={});var AudioContext=window.AudioContext;void 0===AudioContext&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;void 0===URL&&"undefined"!=typeof webkitURL&&(URL=webkitURL),"undefined"!=typeof navigator?(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia)):navigator={getUserMedia:function(){},userAgent:browserFakeUserAgent};var IsEdge=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),IsOpera=!1;"undefined"!=typeof opera&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("OPR/")&&(IsOpera=!0);var IsChrome=!IsEdge&&!IsEdge&&!!navigator.webkitGetUserMedia,MediaStream=window.MediaStream;void 0===MediaStream&&"undefined"!=typeof webkitMediaStream&&(MediaStream=webkitMediaStream),void 0!==MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach(function(t){-1!==t.kind.toString().indexOf("video")&&e.push(t)}),e},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach(function(t){-1!==t.kind.toString().indexOf("audio")&&e.push(t)}),e}),"stop"in MediaStream.prototype||(MediaStream.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop&&e.stop()}),this.getVideoTracks().forEach(function(e){e.stop&&e.stop()})})),"undefined"!=typeof location&&0===location.href.indexOf("file:")&&console.error("Please load this HTML file on HTTP or HTTPS.");var ObjectStore={AudioContext:AudioContext},ObjectStore={AudioContext:window.AudioContext||window.webkitAudioContext};void 0!==MediaStreamRecorder&&(MediaStreamRecorder.MediaRecorderWrapper=MediaRecorderWrapper),void 0!==MediaStreamRecorder&&(MediaStreamRecorder.StereoAudioRecorder=StereoAudioRecorder),void 0!==MediaStreamRecorder&&(MediaStreamRecorder.StereoAudioRecorderHelper=StereoAudioRecorderHelper),void 0!==MediaStreamRecorder&&(MediaStreamRecorder.WhammyRecorder=WhammyRecorder),void 0!==MediaStreamRecorder&&(MediaStreamRecorder.WhammyRecorderHelper=WhammyRecorderHelper),void 0!==MediaStreamRecorder&&(MediaStreamRecorder.GifRecorder=GifRecorder);var Whammy=function(){function e(e,t){this.frames=[],e||(e=1),this.duration=1e3/e,this.quality=t||.8}function t(e){var t=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),o=new Worker(t);return URL.revokeObjectURL(t),o}function o(e){function t(e){var t=i(e);if(!t)return[];for(var r=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:g(t.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]}]}],n=0,a=0;n<e.length;){var c=[],d=0;do{c.push(e[n]),d+=e[n].duration,n++}while(n<e.length&&d<3e4);var u={id:524531317,data:o(a,0,c)};r[1].data.push(u),a+=d}return s(r)}function o(e,t,o){return[{data:e,id:231}].concat(o.map(function(e){var o=c({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(t)});return t+=e.duration,{data:o,id:163}}))}function i(e){if(!e[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var t=e[0].width,o=e[0].height,i=e[0].duration,r=1;r<e.length;r++)i+=e[r].duration;return{duration:i,width:t,height:o}}function r(e){for(var t=[];e>0;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function n(e){return new Uint8Array(e.split("").map(function(e){return e.charCodeAt(0)}))}function a(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var o=0;o<e.length;o+=8)t.push(parseInt(e.substr(o,8),2));return new Uint8Array(t)}function s(e){for(var t=[],o=0;o<e.length;o++){var i=e[o].data;"object"==typeof i&&(i=s(i)),"number"==typeof i&&(i=a(i.toString(2))),"string"==typeof i&&(i=n(i));var c=i.size||i.byteLength||i.length,d=Math.ceil(Math.ceil(Math.log(c)/Math.log(2))/8),u=c.toString(2),l=new Array(7*d+7+1-u.length).join("0")+u,g=new Array(d).join("0")+"1"+l;t.push(r(e[o].id)),t.push(a(g)),t.push(i)}return new Blob(t,{type:"video/webm"})}function c(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),e.trackNum>127)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame}function d(e){for(var t=e.RIFF[0].WEBP[0],o=t.indexOf("*"),i=0,r=[];i<4;i++)r[i]=t.charCodeAt(o+3+i);var n,a,s;return s=r[1]<<8|r[0],n=16383&s,s=r[3]<<8|r[2],a=16383&s,{width:n,height:a,data:t,riff:e}}function u(e,t){return parseInt(e.substr(t+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t}).join(""),2)}function l(e){for(var t=0,o={};t<e.length;){var i=e.substr(t,4),r=u(e,t),n=e.substr(t+4+4,r);t+=8+r,o[i]=o[i]||[],"RIFF"===i||"LIST"===i?o[i].push(l(n)):o[i].push(n)}return o}function g(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")}var m=new t(e.map(function(e){var t=d(l(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(m)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(e){var i=t(o);i.onmessage=function(t){if(t.data.error)return void console.error(t.data.error);e(t.data)},i.postMessage(this.frames)},{Video:e}}();void 0!==MediaStreamRecorder&&(MediaStreamRecorder.Whammy=Whammy),function(){window.ConcatenateBlobs=function(e,t,o){function i(){if(!e[a])return r();var t=new FileReader;t.onload=function(e){n.push(e.target.result),a++,i()},t.readAsArrayBuffer(e[a])}function r(){var e=0;n.forEach(function(t){e+=t.byteLength});var i=new Uint16Array(e),r=0;n.forEach(function(e){var t=e.byteLength;t%2!=0&&(e=e.slice(0,t-1)),i.set(new Uint16Array(e),r),r+=t});var a=new Blob([i.buffer],{type:t});o(a)}var n=[],a=0;i()}}(),"undefined"!=typeof module&&(module.exports=MediaStreamRecorder),"function"==typeof define&&define.amd&&define("MediaStreamRecorder",[],function(){return MediaStreamRecorder});var yim=yim||{};yim.OSType="6",yim.YIMErrorcode={YIMErrorcode_Success:0,YIMErrorcode_EngineNotInit:1,YIMErrorcode_NotLogin:2,YIMErrorcode_ParamInvalid:3,YIMErrorcode_TimeOut:4,YIMErrorcode_StatusError:5,YIMErrorcode_SDKInvalid:6,YIMErrorcode_AlreadyLogin:7,YIMErrorcode_ServerError:8,YIMErrorcode_NetError:9,YIMErrorcode_LoginSessionError:10,YIMErrorcode_NotStartUp:11,YIMErrorcode_FileNotExist:12,YIMErrorcode_SendFileError:13,YIMErrorcode_UploadFailed:14,YIMErrorcode_UsernamePasswordError:15,YIMErrorcode_UserStatusError:16,YIMErrorcode_MessageTooLong:17,YIMErrorcode_ReceiverTooLong:18,YIMErrorcode_InvalidChatType:19,YIMErrorcode_InvalidReceiver:20,YIMErrorcode_UnknowError:21,YIMErrorcode_InvalidAppkey:22,YIMErrorcode_ForbiddenSpeak:23,YIMErrorcode_CreateFileFailed:24,YIMErrorcode_ALREADYFRIENDS:1e3,YIMErrorcode_LoginInvalid:1001,YIMErrorcode_PTT_Start:2e3,YIMErrorcode_PTT_Fail:2001,YIMErrorcode_PTT_DownloadFail:2002,YIMErrorcode_PTT_GetUploadTokenFail:2003,YIMErrorcode_PTT_UploadFail:2004,YIMErrorcode_PTT_NotSpeech:2005,YIMErrorcode_PTT_DeviceStatusError:2006,YIMErrorcode_PTT_IsSpeeching:2007,YIMErrorcode_PTT_FileNotExist:2008,YIMErrorcode_PTT_ReachMaxDuration:2009,YIMErrorcode_PTT_SpeechTooShort:2010,YIMErrorcode_PTT_StartAudioRecordFailed:2011,YIMErrorcode_PTT_SpeechTimeout:2012,YIMErrorcode_Fail:1e4},yim.MessageBodyType={MessageBodyType_Text:0,MessageBodyType_Voice:1,MessageBodyType_File:2},yim.YIMLoginState={YIMLoginState_Init:0,YIMLoginState_Logining:1,YIMLoginState_Success:2,YIMLoginState_Failed:3,YIMLoginState_Logouting:4,YIMLoginState_Reconnect:5},yim.YIMAudioCode={INVOKE_TOOFAST:9001,WAITFOR_LASTINVOKE:9002,INVALID_INVOKE:9003,DUPLICATE_INVOKE:9004,INVOKE_OUTTIME:9005,VOICE_TOOSHORT:9006,WEBRTC_ERROR:9089,INVOKE_ERROR:9090},yim.YIMMessageType={YIMMessageType_Heart:0,YIMMessageType_Login:1,YIMMessageType_Logout:2,YIMMessageType_JoinRoom:3,YIMMessageType_LeaveRoom:4,YIMMessageType_SendMessage:5,YIMMessageType_RecvMessage:6,YIMMessageType_KickOff:7,YIMMessageType_GetUploadToken:8,YIMMessageType_NotifyMsg:9,YIMMessageType_GetMsg:10},yim.MessageVoiceType={WEIXIN:1,WEBRTC:2},yim.debug=!1,yim.extend=function(e){for(var t,o,i={}.hasOwnProperty,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(o in t)i.call(t,o)&&(e[o]=t[o])}return e},yim.extendClass=function(e,t){yim.extend(e.prototype,t.prototype||t),e.prototype.constructor=e},yim.isWeixin=function(){return!!navigator.userAgent.toLowerCase().match(/micromessenger/i)},yim.createEvent=function(e,t,o,i){var r={type:e};return r.code=t,r.data=i||{},r.message=o||"",r},yim.loadScript=function(e,t){t=t||"script";var o,i=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return o=document.createElement("script"),o.async=!0,e.charset&&(o.charset=e.charset),o.onload=o.onreadystatechange=function(i,r){(r||!o.readyState||/loaded|complete/.test(o.readyState))&&(o.onload=o.onreadystatechange=null,"jsonp"===t&&o.parentNode&&o.parentNode.removeChild(o),o=null,"script"!==t||r||e.success(200,"success"))},o.src=e.url,i.insertBefore(o,i.firstChild),{abort:function(){o&&o.onload(void 0,!0)}}};var _serialize=function(e,t){var o,i,r=[];for(var n in e)e.hasOwnProperty(n)&&(o=t?t+"["+n+"]":n,i=e[n],r.push("object"==typeof i?_serialize(i,o):encodeURIComponent(o)+"="+encodeURIComponent(i)));return r.join("&").replace(/%20/g,"+")};yim.jsonp=function(e){var t=e.jsonp||"callback",o=e.success||"JSONP_CALLBACK";"function"==typeof o&&(o=e.jsonpCallback||"JSONP_"+(Math.random()+"").substr(2),window[o]=function(){e.success.apply(null,arguments),e.jsonpCallback||(window[o]=null,delete window[o])});var i=e.url,r=t+"="+o,n=e.data||"";return"object"==typeof n&&(n=_serialize(n)),n=n?n+"&"+r:r,n&&(i+=i.indexOf("?")>-1?"&"+n:"?"+n),e.url=i,e.data="",yim.loadScript(e,"jsonp")},yim.log=function(){window.console&&console.log.apply(console,arguments)},yim.trim=function(e){if(!e)return"";var t="".trim;if(t)return t.call(e);return(e+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},yim.indexOf=function(e,t,o){if(o=o||0,e.indexOf)return e.indexOf(t,o);for(var i=e.length;o<i;o++)if(e[o]==t)return o;return-1},yim.each=function(e,t,o){if(e){if(e.forEach)return e.forEach(t,o);var i=e.length;if("number"==typeof i){if(i>0&&i-1 in e)for(var r=0,n=e.length;r<n&&!1!==t.call(o,e[r],r,e);r++);}else for(var a in e)if(e.hasOwnProperty(a)&&!1===t.call(o,e[a],a,e))break}},yim.event=function(){var e=function(){this._listenList={}};return e.prototype={newInstance:function(){return new e},trigger:function(e,t){var o=this,i=Array.prototype.slice.call(arguments,1)||[];return e=e.split(","),yim.each(e,function(e){e=yim.trim(e);var t=o._listenList[e]||[];yim.each(t,function(t,o){var r=i.slice();r.push(e),t.apply(e,r)})}),o},one:function(e,t){return this.off(e),this.on(e,t)},on:function(e,t){var o=this._listenList;return e=e.split(","),yim.each(e,function(e){e=yim.trim(e),o[e]||(o[e]=[]),o[e].push(t)}),this},off:function(e,t){var o=this._listenList;return e=e.split(","),yim.each(e,function(e){if(e=yim.trim(e),!t)return delete o[e];if(o[e]){var i=yim.indexOf(t);return o[e].splice(i,1)}}),!1}},e.prototype.constructor=e,new e}(),yim.getInstance=function(e,t,o,i){function r(){if(!s.socketio.checkConnected||s.socketio.checkConnected()){if(+new Date-s.pingLastTime>3*s.pingInterval)return s.socketio.autoReconnect();s.allMsgQueue.push({serial:++s.msgSerial,data:{base:s.InterGenBase(yim.YIMMessageType.YIMMessageType_Heart,s.msgSerial)}}),s.InterSendMessage()}}var n,a,s=this,c=null;s.strAppKey=t,null!=e&&(s.keywordInstance=new yim.trieInstance(e)),s.eventHandle=yim.event.newInstance(),s.callbacks={},s._socketReady=null,s.ip="",s.port=0,s.msgSerial=0,s.pingInterval=2e4,s.pingLastTime=0,s.autoRecvMsg=!0,s.allMsgQueue=[],s.curentSendMsg=null,s.uploadQueue=[],s.curentUpload=null,s.joinRooms={},s._recordMsgInfo={},s.socketio=s.getSocketConnection(t,i),s.socketio.on("connect",function(){s.curentSendMsg=null,s.loginStatus==yim.YIMLoginState.YIMLoginState_Success&&(s.loginStatus=yim.YIMLoginState.YIMLoginState_Reconnect,s._sendMsgData({serial:++s.msgSerial,data:{base:s.InterGenBase(yim.YIMMessageType.YIMMessageType_Login,s.msgSerial,{reconnect:1}),appkey:s.strAppKey,userid:s.strUserID,session:s.strToken}}),s.InterSendMessage()),s._socketReady&&s._socketReady.call(s,s.socketio)}),s.socketio.on("connect_error",function(){yim.debug&&console.log("[yim] connect error"),null!=s.heartTimer&&(window.clearInterval(s.heartTimer),s.heartTimer=null)}),s.socketio.on("connect_timeout",function(){yim.debug&&console.log("[yim] connect timeout")}),s.socketio.on("disconnect",function(){yim.debug&&console.log("[yim] disconnect"),null!=s.heartTimer&&(window.clearInterval(s.heartTimer),s.heartTimer=null)}),this.iHeartLossCount=0,this.loginStatus=yim.YIMLoginState.YIMLoginState_Init,null!=o&&(this.callbacks=o),this.uninit=function(){null!=this.curentSendMsg&&null!=this.curentSendMsg.timer&&(window.clearTimeout(this.curentSendMsg.timer),this.curentSendMsg.timer=null),
null!=this.heartTimer&&(window.clearInterval(this.heartTimer),this.heartTimer=null),this.socketio.disconnect(),this.loginStatus=yim.YIMLoginState.YIMLoginState_Init},this.InterGenBase=function(e,t,o){return{msgtype:+e,version:1,os_type:+yim.OSType,ip:this.ip,port:this.port,seq:""+t,ext:o}},this.setAutoRecvMessage=function(e){this.autoRecvMsg=e},this.getNewMessage=function(){this.allMsgQueue.push({serial:++this.msgSerial,data:{base:this.InterGenBase(yim.YIMMessageType.YIMMessageType_GetMsg,this.msgSerial),msgid:""+this.MaxMessageID}}),this.InterSendMessage()},this.login=function(e,t){if(this.strToken=t||"",this.strUserID=e||"",""==this.strToken||""==this.strUserID)return void(this.callbacks.onLogin&&(c=yim.createEvent("StatusError",yim.YIMErrorcode.YIMErrorcode_ParamInvalid,"参数错误!",{userid:this.strUserID,token:this.strToken}),this.callbacks.onLogin(c.code,c)));this.MaxMessageID=Number(localStorage[this.strUserID]),isNaN(this.MaxMessageID)&&(this.MaxMessageID=0),this.loginStatus==yim.YIMLoginState.YIMLoginState_Init||this.loginStatus==yim.YIMLoginState.YIMLoginState_Failed?(this.loginStatus=yim.YIMLoginState.YIMLoginState_Logining,this._sendMsgData({serial:++this.msgSerial,data:{base:this.InterGenBase(yim.YIMMessageType.YIMMessageType_Login,+new Date),appkey:this.strAppKey,userid:this.strUserID,session:this.strToken,notify:1}})):this.callbacks.onLogin&&(c=yim.createEvent("StatusError",yim.YIMErrorcode.YIMErrorcode_StatusError,"登录状态错误: "+this.loginStatus,{userid:this.strUserID}),c.currentStatus=this.loginStatus,s.callbacks.onLogin(c.code,c))},this.logout=function(){if(this.loginStatus==yim.YIMLoginState.YIMLoginState_Init||this.loginStatus==yim.YIMLoginState.YIMLoginState_Failed)return void(this.callbacks.onLogout&&(c=yim.createEvent("StatusError",yim.YIMErrorcode.YIMErrorcode_StatusError,"当前未登录或登录失败: "+this.loginStatus,{userid:this.strUserID}),c.currentStatus=this.loginStatus,s.callbacks.onLogout(c.code,c)));this.loginStatus=yim.YIMLoginState.YIMLoginState_Logouting,this.allMsgQueue.push({serial:++this.msgSerial,data:{base:this.InterGenBase(yim.YIMMessageType.YIMMessageType_Logout,this.msgSerial)}}),this.InterSendMessage()},this.joinRoom=function(e){var t=e||"";return""==t?void(this.callbacks.onJoinChatRoom&&this.callbacks.onJoinChatRoom(yim.YIMErrorcode.YIMErrorcode_ParamInvalid,t)):this.loginStatus==yim.YIMLoginState.YIMLoginState_Init||this.loginStatus==yim.YIMLoginState.YIMLoginState_Failed?void(this.callbacks.onJoinChatRoom&&(c=yim.createEvent("StatusError",yim.YIMErrorcode.YIMErrorcode_StatusError,"加入房间失败，当前未登录或登录失败: "+this.loginStatus,{roomid:e}),c.currentStatus=this.loginStatus,s.callbacks.onJoinChatRoom(c.code,c))):(this.joinRooms[e]=1,this.allMsgQueue.push({serial:++this.msgSerial,data:{base:this.InterGenBase(yim.YIMMessageType.YIMMessageType_JoinRoom,this.msgSerial),roomid:e}}),void this.InterSendMessage())},this.leaveRoom=function(e){var t=e||"";return""==t?void(this.callbacks.onLeaveChatRoom&&this.callbacks.onLeaveChatRoom(yim.YIMErrorcode.YIMErrorcode_ParamInvalid,t)):this.loginStatus==yim.YIMLoginState.YIMLoginState_Init||this.loginStatus==yim.YIMLoginState.YIMLoginState_Failed?void(s.callbacks.onLeaveChatRoom&&(c=yim.createEvent("StatusError",yim.YIMErrorcode.YIMErrorcode_StatusError,"离开房间失败，当前未登录或登录失败: "+this.loginStatus,{roomid:e}),c.currentStatus=this.loginStatus,s.callbacks.onLeaveChatRoom(c.code,c))):(delete this.joinRooms[e],this.allMsgQueue.push({serial:++this.msgSerial,data:{base:this.InterGenBase(yim.YIMMessageType.YIMMessageType_LeaveRoom,this.msgSerial),roomid:e}}),void this.InterSendMessage())},this.sendTextMessage=function(e,t,o){if("function"==typeof this.socketio.checkConnected&&this.socketio.checkConnected(),this.loginStatus==yim.YIMLoginState.YIMLoginState_Success)return this.allMsgQueue.push({serial:++this.msgSerial,data:{base:this.InterGenBase(yim.YIMMessageType.YIMMessageType_SendMessage,this.msgSerial),receiver:e,chattype:+t,content:o,msgbodytype:yim.MessageBodyType.MessageBodyType_Text}}),this.InterSendMessage(),this.msgSerial},this.keywordsFilter=function(e){return null==this.keywordInstance?e:this.keywordInstance.GetFilterText(e,"**")},this._sendMsgData=function(e){var t=this;e.data.base.msgtype==yim.YIMMessageType.YIMMessageType_Login?(n&&n._loginTimer&&clearTimeout(n._loginTimer),n=e,n._loginTimer=setTimeout(function(){!n._loginStatus&&t.callbacks.onLogin&&(c=yim.createEvent("TimeoutError",yim.YIMErrorcode.YIMErrorcode_TimeOut,"登录超时!",{userid:t.strUserID}),t.callbacks.onLogin(c.code,c))},1e4)):e.data.base.msgtype==yim.YIMMessageType.YIMMessageType_JoinRoom&&(a=e),this.socketio.emit("yim",e.data)},this.InterSendMessage=function(){if(null==this.curentSendMsg&&0!=this.allMsgQueue.length){if("function"==typeof this.socketio.checkConnected&&!this.socketio.checkConnected())return;if(this.loginStatus!=yim.YIMLoginState.YIMLoginState_Success)return;var e=this;this.curentSendMsg=this.allMsgQueue.shift(),this._sendMsgData(this.curentSendMsg),this.curentSendMsg.timer=window.setTimeout(function(){if(e.curentSendMsg){switch(yim.debug&&console.log("[yim] 发送消息超时:"+JSON.stringify(e.curentSendMsg.data)+" status: "+e.loginStatus),e.curentSendMsg.data.base.msgtype){case yim.YIMMessageType.YIMMessageType_Login:e.callbacks.onLogin&&(null!=e.curentSendMsg.data.base.ext&&1==e.curentSendMsg.data.base.ext.reconnect||(c=yim.createEvent("TimeoutError",yim.YIMErrorcode.YIMErrorcode_TimeOut,"登录超时!",{userid:e.strUserID}),e.callbacks.onLogin(c.code,c))),e.loginStatus=yim.YIMLoginState.YIMLoginState_Failed;break;case yim.YIMMessageType.YIMMessageType_Logout:e.callbacks.onLogout&&(c=yim.createEvent("TimeoutError",yim.YIMErrorcode.YIMErrorcode_TimeOut,"登出超时!",{userid:e.strUserID}),e.callbacks.onLogout(c.code,c)),e.loginStatus=yim.YIMLoginState.YIMLoginState_Init;break;case yim.YIMMessageType.YIMMessageType_JoinRoom:e.callbacks.onJoinChatRoom&&(null!=e.curentSendMsg.data.base.ext&&1==e.curentSendMsg.data.base.ext.reconnect||(c=yim.createEvent("TimeoutError",yim.YIMErrorcode.YIMErrorcode_TimeOut,"加入房间超时!",{roomid:e.curentSendMsg.data.roomid}),e.callbacks.onJoinChatRoom(c.code,c)));break;case yim.YIMMessageType.YIMMessageType_LeaveRoom:e.callbacks.onLeaveChatRoom&&(c=yim.createEvent("TimeoutError",yim.YIMErrorcode.YIMErrorcode_TimeOut,"离开房间超时!",{roomid:e.curentSendMsg.data.roomid}),e.callbacks.onLeaveChatRoom(c.code,c));break;case yim.YIMMessageType.YIMMessageType_SendMessage:e.callbacks.onSendMessageStatus&&(c=yim.createEvent("TimeoutError",yim.YIMErrorcode.YIMErrorcode_TimeOut,"发送消息超时!",{msgid:e.curentSendMsg.serial}),e.callbacks.onSendMessageStatus(c.code,c));break;case yim.YIMMessageType.YIMMessageType_GetUploadToken:e.callbacks.onVoiceMsgSend&&(c=yim.createEvent("TimeoutError",yim.YIMErrorcode.YIMErrorcode_PTT_GetUploadTokenFail,"获取上传票据超时!",{recordSerial:e.curentSendMsg.serial}),e.callbacks.onVoiceMsgSend(c.code,c),delete e._recordMsgInfo[recordSerial]);break;case yim.YIMMessageType.YIMMessageType_Heart:}e.curentSendMsg=null,e.InterSendMessage()}},1e4)}},this.initVociceMsgAutoPlay=function(e,t){this.initVociceMsgAutoPlay.init||(this.initVociceMsgAutoPlay.init=1)},this.socketio.on("yim",function(e){var t,o=e.base.msgtype;switch(o){case yim.YIMMessageType.YIMMessageType_GetMsg:for(var i=e.msg_list,d=0,u=0;u<i.length;u++){var l={},g=i[u].msgtype;g==yim.MessageBodyType.MessageBodyType_Text?l={senderid:i[u].sender,recvid:i[u].receiver,chattype:i[u].chattype,messageid:i[u].serial,content:i[u].content,createtime:i[u].timespan,msgType:g}:g==yim.MessageBodyType.MessageBodyType_Voice&&(l={senderid:i[u].sender,recvid:i[u].receiver,chattype:i[u].chattype,messageid:i[u].serial,content:i[u].content,createtime:i[u].timespan,msgType:g}),Number(i[u].serial)>d&&(d=Number(i[u].serial)),s.callbacks.onRecvMessage&&s.callbacks.onRecvMessage(l)}d>s.MaxMessageID&&(s.MaxMessageID=d,localStorage[s.strUserID]=d),0!=i.length&&s.getNewMessage();break;case yim.YIMMessageType.YIMMessageType_NotifyMsg:for(var m=e.args,h=0,f="",u=0;u<m.length;u++){var p=m[u].name,y=m[u].value;"msg_id"==p?h=y:"msg_for"==p&&(f=y)}s.autoRecvMsg?s.getNewMessage():s.callbacks.onReceiveMessageNotify&&s.callbacks.onReceiveMessageNotify(h,f);break;case yim.YIMMessageType.YIMMessageType_GetUploadToken:var M=e.ret,v=e.base.seq;if(0!=M)s.callbacks.onVoiceMsgSend&&(c=yim.createEvent("TimeoutError",yim.YIMErrorcode.YIMErrorcode_PTT_GetUploadTokenFail,"获取上传票据超时!",{recordSerial:v,_data:e}),s.callbacks.onVoiceMsgSend(c.code,c),delete s._recordMsgInfo[v]);else{var I={token:e.token,downloadurl:e.downloadurl,headers:e.headers,serial:v};s.uploadQueue.push(I),s.InterUpload()}break;case yim.YIMMessageType.YIMMessageType_KickOff:s.callbacks.onKickOff&&s.callbacks.onKickOff(),null!=s.heartTimer&&(window.clearInterval(s.heartTimer),s.uninit(),s.heartTimer=null);break;case yim.YIMMessageType.YIMMessageType_Login:if(t=yim.YIMLoginState.YIMLoginState_Success,e.ret==yim.YIMErrorcode.YIMErrorcode_Success?(s.loginStatus=yim.YIMLoginState.YIMLoginState_Success,s.ip=e.ip,s.msgSerial=e.base.seq||s.msgSerial,s.port=e.port,s.pingLastTime=+new Date,window.clearInterval(s.heartTimer),s.heartTimer=window.setInterval(r,s.pingInterval)):s.loginStatus=yim.YIMLoginState.YIMLoginState_Failed,n._loginStatus=s.loginStatus,n._loginTimer&&(clearTimeout(n._loginTimer),n._loginTimer=0),s.callbacks.onLogin&&(n&&n.data.base.ext&&1==n.data.base.ext.reconnect||(c=yim.createEvent("ResultEvent",e.ret,s.loginStatus==t?"ok!":"fail!",{userid:s.strUserID,_data:e}),s.callbacks.onLogin(c.code,c)),n&&n.data.base.ext&&1==n.data.base.ext.reconnect)){s.callbacks.onReLogin&&(c=yim.createEvent("ResultEvent",e.ret,s.loginStatus==t?"ok!":"fail!",{userid:s.strUserID,_data:e}),s.callbacks.onReLogin(c.code,c));for(var p in s.joinRooms)null!=s.joinRooms[p]&&(s.allMsgQueue.push({serial:++s.msgSerial,data:{base:s.InterGenBase(yim.YIMMessageType.YIMMessageType_JoinRoom,s.msgSerial,{reconnect:1}),roomid:p}}),s.InterSendMessage())}break;case yim.YIMMessageType.YIMMessageType_Logout:s.callbacks.onLogout&&(c=yim.createEvent("ResultEvent",e.ret,"ok!",{userid:s.strUserID,_data:e}),s.callbacks.onLogout(c.code,c)),null!=s.heartTimer&&(window.clearInterval(s.heartTimer),s.heartTimer=null),s.loginStatus=yim.YIMLoginState.YIMLoginState_Init;break;case yim.YIMMessageType.YIMMessageType_JoinRoom:s.callbacks.onJoinChatRoom&&(null==s.curentSendMsg?yim.debug&&console.log("[yim] 消息已经超时了，但是服务器又通知了消息"):(a&&a.data.base.ext&&1==a.data.base.ext.reconnect||(c=yim.createEvent("ResultEvent",e.ret,"ok!",{roomid:s.curentSendMsg.data.roomid,_data:e}),s.callbacks.onJoinChatRoom(c.code,c)),a&&a.data.base.ext&&1==a.data.base.ext.reconnect&&s.callbacks.onReJoinChatRoom&&(c=yim.createEvent("ResultEvent",e.ret,"ok!",{roomid:s.curentSendMsg.data.roomid,_data:e}),s.callbacks.onReJoinChatRoom(c.code,c))));break;case yim.YIMMessageType.YIMMessageType_LeaveRoom:s.callbacks.onLeaveChatRoom&&(null==s.curentSendMsg?yim.debug&&console.log("[yim] 消息已经超时了，但是服务器又通知了消息"):(c=yim.createEvent("ResultEvent",e.ret,"ok!",{roomid:s.curentSendMsg.data.roomid,_data:e}),s.callbacks.onLeaveChatRoom(c.code,c)));break;case yim.YIMMessageType.YIMMessageType_SendMessage:s.callbacks.onSendMessageStatus&&(null==s.curentSendMsg?yim.debug&&console.log("[yim] 消息已经超时了，但是服务器又通知了消息"):(c=yim.createEvent("ResultEvent",e.ret,"ok!",{msgid:s.curentSendMsg.serial,_data:e}),s.callbacks.onSendMessageStatus(e.ret,c)));break;case yim.YIMMessageType.YIMMessageType_RecvMessage:if(s.callbacks.onRecvMessage){var l={},g=e.msgbodytype;g==yim.MessageBodyType.MessageBodyType_Text?l={senderid:e.sender,recvid:e.receiver,chattype:e.chattype,messageid:e.serial,content:e.content,createtime:e.timespan,msgType:g}:g==yim.MessageBodyType.MessageBodyType_Voice&&(l={senderid:e.sender,recvid:e.receiver,chattype:e.chattype,messageid:e.serial,content:e.content,createtime:e.timespan,msgbodytype:e.msgbodytype,msgType:g}),s.callbacks.onRecvMessage&&s.callbacks.onRecvMessage(l)}break;case yim.YIMMessageType.YIMMessageType_Heart:s.pingLastTime=+new Date,s.iHeartLossCount=0}o!=yim.YIMMessageType.YIMMessageType_RecvMessage&&o!=yim.YIMMessageType.YIMMessageType_Login&&(null!=s.curentSendMsg&&(window.clearTimeout(s.curentSendMsg.timer),s.curentSendMsg=null),s.InterSendMessage())}),this.InterUpload=function(){function e(e){yim.debug&&console.log("[yim] upload voice error :",e);var o=t.curentUpload.serial;t.callbacks.onVoiceMsgSend&&(c=yim.createEvent("Error",yim.YIMErrorcode.YIMErrorcode_PTT_UploadFail,"Upload Error",{errEvent:e,msgid:o}),t.callbacks.onVoiceMsgSend(c.code,c)),delete t._recordMsgInfo[o]}if(null==this.curentUpload&&0!=this.uploadQueue.length){var t=this;this.curentUpload=this.uploadQueue.shift();var o=new XMLHttpRequest;o.onerror=e,o.ontimeout=e,o.onloadend=function(e){t.curentUpload=null,t.InterUpload()},o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){yim.debug&&console.log("[yim] voice upload suc!");var e=t.curentUpload.serial,i=t._recordMsgInfo[e].receiver,r=t._recordMsgInfo[e].chattype,n={downloadurl:t.curentUpload.downloadurl.replace(/^http\:/,""),datasize:t._recordMsgInfo[e].data.size,voicetime:t._recordMsgInfo[e].voiceTime,recordmode:yim.MessageVoiceType.WEBRTC};t.allMsgQueue.push({serial:e,data:{base:t.InterGenBase(yim.YIMMessageType.YIMMessageType_SendMessage,e),receiver:i,chattype:r,content:JSON.stringify(n),msgbodytype:yim.MessageBodyType.MessageBodyType_Voice}}),t.InterSendMessage();var a=a||t.callbacks.onVoiceMsgSend||function(){};a(yim.YIMErrorcode.YIMErrorcode_Success,{voiceTime:t._recordMsgInfo[e].voiceTime,voiceURL:n.downloadurl,voiceSize:n.datasize,msgID:e}),delete t._recordMsgInfo[e]}};var i=this.curentUpload.token,r=i.indexOf(":");(r>-1||r<7)&&(i=i.substr(r+1)),o.open("PUT",i,!0),o.timeout=6e4;for(var n in this.curentUpload.headers)"host"!=n&&this.curentUpload.headers.hasOwnProperty(n)&&o.setRequestHeader(n,this.curentUpload.headers[n]);o.send(this._recordMsgInfo[this.curentUpload.serial].data)}},this.ready=function(e){this._socketReady=e}},yim.SocketClass=function(e){var t=e.WebSocket||e.MozWebSocket;this._socketio=null,this._socketConfig={socketio:"https://webim.youme.im/",websocket:"h5.youme.im:443"};var o={},i=function(e,t){var i=o[e];if(i)for(var r=0,n=i.fnlist.length;r<n;r++)i.fnlist[r].apply(this,t)},r=function(e,t,r){o[t]=o[t]||{bind:!1,fnlist:[]};var n=o[t];n.fnlist.push(r),n.bind||(n.bind=function(){i(t,arguments)},e.addEventListener(t,n.bind))},n=function(e){for(var t in o)o.hasOwnProperty(t)&&e.removeEventListener(t,o[t].bind);o={}},a=function(){var e=this;if(!(e instanceof a))return new a;e._status="disconnected",e._host="",e._socket=null,e._onConfig={},e._connectTimer=0,e._reconnetTimer=0,e._reconnetNum=0,e._skipReconnect=!1,e._lastConnectTime=0,e._config={timeout:1e4,reconnect:!0,reconnectDelay:5e3},e._event=yim.event.newInstance(),e.on("connect_error,disconnect",function(){yim.debug&&console.log("[yim] get socket disconnect!"),e.autoReconnect()})};a.prototype.close=function(){var e=this,t=1e3;for(n(e._socket);e._socket&&t>0&&e._socket.readyState===this._socket.OPEN;)t-=1,e._socket.close();return e._socket&&e._socket.readyState!==e._socket.OPEN},a.prototype.connect=function(e,o){var i=this;return e&&(i._host=e),i.close(),i._status="connecting",i._skipReconnect=!1,e?i._host=e:e=i._host,i._config=yim.extend(i._config,o||{}),e="ws"!=e.substr(0,2)?"ws://"+e:e,yim.debug&&console.log("[yim] start connect to:"+e),i._socket=new t(e),r(i._socket,"open",function(e){i._status="connected",i._reconnetNum=0,clearTimeout(i._reconnetTimer),clearTimeout(i._connectTimer),yim.debug&&console.log("[yim] websocket connected!",e),i._event.trigger("websocket.open,websocket.connect",e)}),r(i._socket,"error",function(e){i._status="disconnected",i._reconnetNum=0,clearTimeout(i._connectTimer),console.error("websocket error!",e),i._event.trigger("websocket.error,websocket.connect_error",e)}),r(i._socket,"close",function(e){i._status="disconnected",i._lastConnectTime=0,clearTimeout(i._connectTimer),yim.debug&&console.log("[yim] websocket close!",e),i._event.trigger("websocket.close,websocket.disconnect",e)}),r(i._socket,"message",function(e){var t=JSON.parse(e.data);yim.debug&&console.log("[yim] receive data:"+JSON.stringify(t)),i._event.trigger("websocket.message",e),i._event.trigger("websocket.yim",t)}),i._connectTimer=setTimeout(function(){i._status="disconnected";var e=yim.createEvent("Error");e.message="WebSocket connect timeout!",console.error(e.message,e),i._event.trigger("websocket.connect_error",e)},i._config.timeout),this},a.prototype.reconnect=function(){var e=this;return e._reconnetNum+=1,yim.debug&&console.log("[yim] start reconnect!"),e.connect(),e},a.prototype.autoReconnect=function(e){var t=this;if("stop"!=t._status){e&&(t._host=e);var o=+new Date;return o-t._lastConnectTime<2e3?void(yim.debug&&console.log("[yim] connect too fast!")):"connecting"===t._status?void(yim.debug&&console.log("[yim] wait for connect!")):(t._lastConnectTime=o,yim.debug&&console.log("[yim] start auto reconnect!"),clearTimeout(t._reconnetTimer),!(!t._config.reconnect||t._skipReconnect)&&(t._reconnetTimer=setTimeout(t.reconnect.bind(t),t._reconnetNum>0?t._config.reconnectDelay:100),t))}},a.prototype.disconnect=function(){var e=this;return e._status="stop",e._skipReconnect=!0,e._socket&&e.close(),e},a.prototype.on=function(e,t){var o=this;return e=e.split(","),yim.each(e,function(e,i){o._event.on("websocket."+e,t)}),this},a.prototype.off=function(e,t){return this._event.off("websocket."+e,t),this},a.prototype.checkConnected=function(){var e=this;if(!e._socket||e._socket.readyState==this._socket.CLOSED){var t=new ErrorEvent("error",{error:new Error("WebSocket disconnect!"),message:"WebSocket disconnect!"});return e._event.trigger("websocket.connect_error",t),!1}return!0},a.prototype.isConnected=function(){var e=this;return e._socket&&e._socket.readyState===e._socket.OPEN},a.prototype.emit=function(e,t){var o=this,i=JSON.stringify(t);if(yim.debug&&console.log("[yim] send key:"+e+"; send data:"+i),!o._socket||o._socket.readyState!==o._socket.OPEN)throw new Error("WebSocket disconnect!");return o._event.trigger("websocket.send",e,i,t),o._socket.send(i),o},this.getSocketConnection=function(e,o){if(t&&!o){var i="wss://"+e.substr(e.length-8).toLowerCase()+"."+this._socketConfig.websocket;this._socketio=a().connect(i)}else this._socketio=io.connect(this._socketConfig.socketio);return this._socketio}},yim.extendClass(yim.getInstance,new yim.SocketClass(window)),yim.MediaInterface=function(){this._supportAudioMessage=!1,this._mediaConfig={maxRecordSecond:60,showProgressTips:1,minInvokeInterval:2,mediaConstraints:{audio:!0}},this.startAudioMessage=function(e,t){},this.stopAudioMessage=function(){},this.cancelAudioMessage=function(){},this.playAudioMessage=function(){},this.playAudioURL=function(e){var t=new window.Audio;return t.src=e,t.loop=!1,t.play(),t},this.initAutoPlayVoiceQueue=function(e){},this.addToAutoPlayVoiceQueue=function(e){},this.getSupportAudioMessage=function(){return this._supportAudioMessage};this.initAudioMedia=function(e,t){t=t||function(){},"function"==typeof e&&(t=e,e={});var o=this;e=e||{},yim.extend(this._mediaConfig,e),this._mediaConfig.maxRecordSecond=Math.min(parseInt(this._mediaConfig.maxRecordSecond,10),60),this._mediaConfig.maxRecordSecond<1&&(this._mediaConfig.maxRecordSecond=60),yim.isWeixin()?(yim.extendClass(yim.getInstance,new yim.WeixinMedia),this.initWeixinRecord(this._mediaConfig,function(e){t.call(o,{type:"weixin",support:e})})):(yim.extendClass(yim.getInstance,new yim.StandardMedia),this.initStandardRecord(this._mediaConfig,function(e){t.call(o,{type:"webrtc",support:e})}))}},yim.extendClass(yim.getInstance,new yim.MediaInterface),yim.StandardMedia=function(){function e(e,t,o){navigator.mediaDevices.getUserMedia(e).then(t).catch(o)}function t(){yim.debug&&console.log.apply(console,arguments)}function o(e){var o=e.data.size,i=new FileReader,n=Date.now();i.onload=function(i){r.postMessage({cmd:"encode",rawInput:i.target.result}),r.postMessage({cmd:"finish"}),r.onmessage=function(i){if("end"==i.data.cmd){t("[yim][mp3worker]Done converting to Mp3");var r=new Blob(i.data.buf,{type:"audio/mp3"});t("[yim][mp3worker]Conversion completed in: "+(Date.now()-n)/1e3+"s");var a=r.size;t("[yim][mp3worker]Initial size: = "+o+", Final size = "+a+", Reduction: "+Number(100*(o-a)/o).toPrecision(4)+"%"),e.onProgress&&e.onProgress(1),e.onSuccess&&e.onSuccess(r)}else"progress"==i.data.cmd?e.onProgress&&e.onProgress(i.data.progress):"error"==i.data.cmd&&t("[yim][mp3worker]error",i)}},i.readAsArrayBuffer(e.data)}var i,r,n=-1,a=null,s=0,c={},d=0,u=null,l="",g=[],m=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,h=function(e){return m?new Promise(function(t,o){m.call(navigator,e,t,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser-getUserMedia"))};void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&m&&(navigator.mediaDevices.getUserMedia=h);var f=function(e,t){t=t||this._mediaConfig.minInvokeInterval,t=t||1;var o=+new Date;return!(o-(c[e]||0)<1e3*t)&&(c[e]=o,o)},p=function(){clearTimeout(d),n=-1},y=function(e){yim.debug&&console.log("[yim] 启动录音成功"),a=new MediaStreamRecorder(e),a.stream=e,a.mimeType="audio/wav",a.audioChannels=1;a.ondataavailable=function(e){i&&(yim.debug&&console.log("[yim] send audio msg!"),i(e))},a.start(6e4)};this._sendAudioBlob=function(e,t,o){var i=this;i._recordMsgInfo[e].data=t,i._recordMsgInfo[e].voiceTime=Math.ceil(o/1e3);var r=i.strUserID+"_"+(new Date).getTime()+"_"+e+"_"+o+"_"+t.size,n=md5.create();n.update(r);var a=n.hex();i.allMsgQueue.push({serial:e,data:{base:i.InterGenBase(yim.YIMMessageType.YIMMessageType_GetUploadToken,e,{Serial:e}),filesize:t.size,filemd5:a,filename:e.toString(),filesuffix:t.type.split("/")[1]}}),i.InterSendMessage()},this.startAudioMessage=function(t,o,r){var a=this;return r=r||function(){},a._supportAudioMessage?f.call(a,"startRecord")?(-1!==n&&console.warn("[yim] last invoke not complete!"),M(),_stopMsgSerial=0,i=!1,n=++this.msgSerial,this._recordMsgInfo[this.msgSerial]={receiver:t,chattype:o,msgbodytype:yim.MessageBodyType.MessageBodyType_Voice},d=setTimeout(function(){yim.debug&&console.log("[yim] Media record more than "+a._mediaConfig.maxRecordSecond+" seconds"),a.stopAudioMessage()},1e3*a._mediaConfig.maxRecordSecond),s=+new Date,a.eventHandle.trigger("voicerecord.beforestart",{}),e(a._mediaConfig.mediaConstraints,function(e){yim.debug&&console.log("[yim] 启动录音成功"),r(yim.YIMErrorcode.YIMErrorcode_Success,{errCode:yim.YIMErrorcode.YIMErrorcode_Success,errMsg:"ok",stream:e}),y.call(a,e),a.eventHandle.trigger("voicerecord.start",{})},function(e){yim.debug&&console.log("[yim] 启动录音失败"),r(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.WEBRTC_ERROR,errMsg:"启用录音失败！",errEvent:e})}),this.msgSerial):r(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.INVOKE_TOOFAST,errMsg:"调用录音接口太快，请等待"+a._mediaConfig.minInvokeInterval+"s重试"}):r(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.WEBRTC_ERROR,errMsg:"当前浏览器不支持录音！"})};var M=function(){a&&(yim.debug&&console.log("[yim] stop media record!"),a.stream.stop(),a.stop(),a=!1)},v=function(e,t){return i=!1,-1==n?(e(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.INVALID_INVOKE,errMsg:"未调用开始录音，无需停止！"}),!1):a&&a.stream&&a.stream.active?(i=t,M(),i||e(yim.YIMErrorcode.YIMErrorcode_Success,{errCode:yim.YIMErrorcode.YIMErrorcode_Success,errMsg:"ok!"}),!0):(e(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.DUPLICATE_INVOKE,errMsg:"已调用停止录音，重复调用！"}),!1)};this.stopAudioMessage=function(e){var t=this;e=e||function(){};var i=+new Date-s,a=n;return v(e,function(n){if(i<1e3)return p(),e(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.VOICE_TOOSHORT,errMsg:"语音时长过短，请重新发送"});r?o({data:n,onSuccess:function(e){t._sendAudioBlob(a,e,i)}}):t._sendAudioBlob(a,n,i)}),p(),t.eventHandle.trigger("voicerecord.stop",{msgid:a,stopTime:i}),!0},this.cancelAudioMessage=function(e){var t=this;e=e||function(){},v(e,!1),p(),t.eventHandle.trigger("voicerecord.cancel",{})},this.playAudioMessage=function(e,t){var o=this;if(t=t||function(){},!e)throw new Error("voiceURL null!");o.eventHandle.trigger("voiceplay.beforestart",{voiceURL:e}),o.eventHandle.trigger("voiceplay.start",{voiceURL:e}),u&&u.pause&&u.pause(),yim.debug&&console.log("[yim] start play:",e),u=o.playAudioURL(e);var i=!1,r=function(r){i||(i=!0,u=null,o.eventHandle.trigger("voiceplay.stop",{voiceURL:e}),t(yim.YIMErrorcode.YIMErrorcode_Success,{errCode:yim.YIMErrorcode.YIMErrorcode_Success,errMsg:"ok",errEvent:r}))};u.addEventListener("ended",r),u.addEventListener("pause",r)},this.pausePlayAudioMessage=function(e,t){var o=this;"function"==typeof e&&(t=e,e=""),t=t||function(){},o.eventHandle.trigger("voiceplay.pause",{voiceURL:e}),u&&u.pause&&u.pause(),t(yim.YIMErrorcode.YIMErrorcode_Success,{errCode:yim.YIMErrorcode.YIMErrorcode_Success,errMsg:"ok"})},this.stopPlayAudioMessage=function(e,t){var o=this;"function"==typeof e&&(t=e,e=""),t=t||function(){},o.eventHandle.trigger("voiceplay.stop",{voiceURL:e}),u&&u.pause&&(u.pause(),isNaN(u.duration)||(u.currentTime=0)),t(yim.YIMErrorcode.YIMErrorcode_Success,{errCode:yim.YIMErrorcode.YIMErrorcode_Success,errMsg:"ok"})};var I=0,b="",S=function(){if("playing"!=l&&"recording"!=l&&!(g.length<1)){var e=g[0];yim.debug&&console.log("[yim] start auto play:"+e._wxcontent.downloadurl,e),this.playAudioMessage(e._wxcontent.downloadurl)}};this.addToAutoPlayVoiceQueue=function(e){var t=this,o=e.content;if("string"==typeof o&&(o="{"==o.charAt(0)?JSON.parse(o):{}),e._wxcontent=o,!e._wxcontent.downloadurl)return void console.error("[autovoice] msg content error!",e);g.push(e),yim.debug&&console.log("[yim] [autovoice] add msg to play queue!",e),g.length>200&&g.splice(0,50),S.call(t)};var _=function(e){for(var t=0,o=Math.min(5,g.length);t<o;t++)if(g[t]._wxcontent.downloadurl==e)return[t,g[t]]};this.initAutoPlayVoiceQueue=function(e){e=e||{};var t=this;t.initAutoPlayVoiceQueue=function(){},t.eventHandle.on("voicerecord.beforestart",function(e){clearTimeout(I);var o=l;l="recording","playing"==o&&t.pausePlayAudioMessage(b)}),t.eventHandle.on("voicerecord.stop, voicerecord.cancel",function(e){l="",b="",clearTimeout(I),I=setTimeout(function(){S.call(t)},500)}),t.eventHandle.on("voiceplay.start",function(o){l="playing",b=o.voiceURL;var i=_(b);i&&e.beginPlay&&(i[1].__hasPaused=0,e.beginPlay.call(t,i[1]))});var o=function(o){"recording"!=l&&(l="",b="");var i=_(o);return i&&e.endPlay&&e.endPlay.call(t,i[1]),i};t.eventHandle.on("voiceplay.cancel, voiceplay.pause",function(e){var t=o(e.voiceURL);t&&(t[1].__hasPaused=1)}),t.eventHandle.on("voiceplay.stop",function(e){var i=o(e.voiceURL);i&&i[1].__hasPaused<1&&(g.splice(i[0],1),yim.debug&&console.log("[yim] [autovoice] msg play end and remove!",i[1])),clearTimeout(I),I=setTimeout(function(){S.call(t)},100)})};var w=function(e){if(!window.Worker)return null;e=e||"./js/mp3Worker.js";return r=new Worker(e),r.onerror=function(e){console.error("[yim][mp3Worker]ERROR:",e),r=null},r};this.initStandardRecord=function(e,t){e=e||{};var o=this;this._supportAudioMessage=!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),r=w(e.mp3Worker),r&&(e.sampleRate=16e3,e.bitRate=e.bitRate||96,r.postMessage({cmd:"init",config:e})),t.call(o,o._supportAudioMessage)}},yim.WeixinMedia=function(){var e=0,t=-1,o=0,i="",r={},n={},a=[],s=[],c="",d={},u=0,l=null,g=null,m=function(){clearTimeout(o),t=-1},h=function(e,t){var o=this;e.appid&&e.sign&&wx.config({appId:e.appid,timestamp:e.time,nonceStr:e.nonce,signature:e.sign,jsApiList:["checkJsApi","startRecord","stopRecord","playVoice","stopVoice","onVoicePlayEnd","downloadVoice","uploadVoice"]}),wx.ready(function(){wx.onVoicePlayEnd({success:function(e){n[e.localId]&&n[e.localId].callback(yim.YIMErrorcode.YIMErrorcode_Success,e),o.eventHandle.trigger("voiceplay.stop",{localId:e.localId,curPlayMsg:g})}}),t()})},f=function(e,t){var o=this;if("function"==typeof e&&(t=e,e={}),window.wx&&window.wx.ready)return h.call(o,e,t);yim.loadScript({url:"http://res.wx.qq.com/open/js/jweixin-1.0.0.js",success:function(){h.call(o,e,t)}})},p=function(e,t,o){i=t;var r=this._recordMsgInfo[e];delete this._recordMsgInfo[e];var n={voicetime:o,mediaid:i,recordmode:yim.MessageVoiceType.WEIXIN};return this.allMsgQueue.push({serial:++this.msgSerial,data:{base:this.InterGenBase(yim.YIMMessageType.YIMMessageType_SendMessage,i),receiver:r.receiver,chattype:+r.chattype,content:JSON.stringify(n),msgbodytype:r.msgbodytype}}),this.InterSendMessage(),this.msgSerial},y=function(e,o){var i=this,r=r||i.callbacks.onVoiceMsgSend;wx.uploadVoice({localId:e,isShowProgressTips:i._mediaConfig.showProgressTips?1:0,success:function(n){var a=n.serverId,s=p.call(i,t,a,o);m(),r&&"function"==typeof r&&r(yim.YIMErrorcode.YIMErrorcode_Success,{voiceTime:o,voiceLocalID:e,voiceServerID:a,msgID:s},n)},fail:function(e){m(),r(yim.YIMErrorcode.YIMErrorcode_Fail,e)}})},M=function(e,t){t=t||this._mediaConfig.minInvokeInterval,t=t||1;var o=+new Date;return!(o-(d[e]||0)<1e3*t)&&(d[e]=o,o)};this.startAudioMessage=function(i,r,n){var a=this;return n=n||function(){},M.call(a,"startRecord")?(-1!==t&&(wx.stopRecord(),console.warn("[yim] last invoke not complete!")),u=0,t=++this.msgSerial,this._recordMsgInfo[t]={receiver:i,chattype:r,msgbodytype:yim.MessageBodyType.MessageBodyType_Voice},o=setTimeout(function(){yim.debug&&console.log("[yim] Media record more than "+a._mediaConfig.maxRecordSecond+" seconds"),a.stopAudioMessage()},1e3*a._mediaConfig.maxRecordSecond),e=+new Date,a.eventHandle.trigger("voicerecord.beforestart",{}),wx.startRecord({success:function(e){n(yim.YIMErrorcode.YIMErrorcode_Success,e),a.eventHandle.trigger("voicerecord.start",{})},fail:function(e){n(yim.YIMErrorcode.YIMErrorcode_Fail,e)}}),!0):n(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.INVOKE_TOOFAST,errMsg:"调用录音接口太快，请等待"+a._mediaConfig.minInvokeInterval+"s重试"})};var v=0,I=function(o,i){if(-1==t)return o(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.INVALID_INVOKE,errMsg:"未调用开始录音，无需停止！"}),!1;if(u)return o(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.DUPLICATE_INVOKE,errMsg:"已调用停止录音，重复调用！"}),!1;var r=+new Date-e,n=arguments;if(clearTimeout(v),r<1e3)return v=setTimeout(function(){I.apply(window,n)},1e3-r),!1;u=t;var a=setTimeout(function(){i.fail.apply(window,[{errCode:yim.YIMAudioCode.INVOKE_OUTTIME,errMsg:"停止录音接口调用超时！"}])},2e3),s={success:function(){clearTimeout(a),i.success.apply(window,arguments)},fail:function(){clearTimeout(a),i.fail.apply(window,arguments)}};return wx.stopRecord(s),!0};this.stopAudioMessage=function(t){var o=this;t=t||function(){};var i=!1,r=+new Date-e;return I(t,{success:function(n){if(r<1e3)return m(),t(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.VOICE_TOOSHORT,errMsg:"语音时长过短，请重新发送"});var a=+new Date-e;i=!0;var s=Math.ceil(a/1e3);setTimeout(function(){y.call(o,n.localId,s),t(yim.YIMErrorcode.YIMErrorcode_Success,n),o.eventHandle.trigger("voicerecord.stop",{localId:n.localId})},10)},fail:function(e){i||(m(),t(yim.YIMErrorcode.YIMErrorcode_Fail,e))}}),!0},this.cancelAudioMessage=function(e){var t=this;return e=e||function(){},I(e,{success:function(o){m(),e(yim.YIMErrorcode.YIMErrorcode_Success,o),t.eventHandle.trigger("voicerecord.cancel",{localId:o.localId,curPlayMsg:g})},fail:function(t){m(),e(yim.YIMErrorcode.YIMErrorcode_Fail,t)}}),!0};var b=function(e,t,o){o=o||function(){},n[t]={serverId:e,callback:o};var i=this;i.eventHandle.trigger("voiceplay.start",{localId:t,curPlayMsg:g}),wx.playVoice({localId:t,success:function(){},fail:function(e){o(yim.YIMErrorcode.YIMErrorcode_Fail,e),i.eventHandle.trigger("voiceplay.cancel",{localId:t,curPlayMsg:g})}})};this.playAudioMessage=function(e,t){var o=this
;if(t=t||function(){},!M.call(o,"startPlay",1))return t(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.INVOKE_TOOFAST,errMsg:"调用播放录音接口太快，请等待1s重试"});if(!(e=e||i))return t(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.INVOKE_ERROR,errMsg:"mediaID invalid!"});if("//"==e.substr(0,2)||"http://"==e.substr(0,7)||"https:/"==e.substr(0,7)){o.eventHandle.trigger("voiceplay.beforestart",{voiceURL:e,curPlayMsg:g}),o.eventHandle.trigger("voiceplay.start",{voiceURL:e,curPlayMsg:g}),l&&l.pause&&l.pause(),yim.debug&&console.log("[yim] start play:",e),l=o.playAudioURL(e);var s=!1,c=function(i){s||(s=!0,l=null,o.eventHandle.trigger("voiceplay.stop",{voiceURL:e,curPlayMsg:g}),t(yim.YIMErrorcode.YIMErrorcode_Success,{errCode:yim.YIMErrorcode.YIMErrorcode_Success,errMsg:"ok",errEvent:i}))};return l.addEventListener("ended",c),void l.addEventListener("pause",c)}o.eventHandle.trigger("voiceplay.beforestart",{serverId:e,curPlayMsg:g});for(var d=a.splice(100),u=0,m=d.length;u<m;u++){var h=r[d[u]];delete n[h],delete r[d[u]]}var f=r[e];f?b.call(o,e,f,t):wx.downloadVoice({serverId:e,isShowProgressTips:o._mediaConfig.showProgressTips?1:0,success:function(i){if(!i.localId)return t(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.INVOKE_ERROR,errMsg:"download voice ERR!"});r[e]=i.localId,a.splice(0,0,e),b.call(o,e,i.localId,t)},fail:function(e){t(yim.YIMErrorcode.YIMErrorcode_Fail,e)}})};var S=function(e,t){var o=this;t=t||function(){},o.eventHandle.trigger("voiceplay.beforestop",{localId:e,curPlayMsg:g}),yim.debug&&console.log("[yim]invoke wx.stopVoice:"+e),wx.stopVoice({localId:e,success:function(e){t(yim.YIMErrorcode.YIMErrorcode_Success,e)},fail:function(e){t(yim.YIMErrorcode.YIMErrorcode_Fail,e)}})};this.stopPlayAudioMessage=function(e,t){var o=this;return t=t||function(){},M.call(o,"stopPlay",1)?r[e]?(e=e||i,void S.call(o,r[e],t)):t(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.INVALID_INVOKE,errMsg:"未播放，无需停止"}):t(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.INVOKE_TOOFAST,errMsg:"调用停止播放接口太快，请等待1s重试"})};var _=function(e,t){var o=this;t=t||function(){},o.eventHandle.trigger("voiceplay.beforepause",{localId:e,curPlayMsg:g}),yim.debug&&console.log("[yim]invoke wx.pauseVoice:"+e),wx.pauseVoice({localId:e,success:function(e){t(yim.YIMErrorcode.YIMErrorcode_Success,e)},fail:function(e){t(yim.YIMErrorcode.YIMErrorcode_Fail,e)}})};this.pausePlayAudioMessage=function(e,t){var o=this;if(t=t||function(){},!M.call(o,"pausePlay",1))return t(yim.YIMErrorcode.YIMErrorcode_Fail,{errCode:yim.YIMAudioCode.INVOKE_TOOFAST,errMsg:"调用停止播放接口太快，请等待1s重试"});e=e||i,_.call(this,r[e],t)};var w=0,T="",E=function(){var e=this;"playing"!=c&&"recording"!=c&&(s.length<1||(g&&g._endtimer&&(clearTimeout(g._endtimer),g._endtimer=0,e.eventHandle.trigger("voicerecord.cancel",{localId:null,curPlayMsg:g})),g=s.splice(0,1)[0],g._endtimer=setTimeout(function(){e.eventHandle.trigger("voicerecord.cancel",{localId:null,curPlayMsg:g})},2e3*g._wxcontent.voicetime),yim.debug&&console.log("[yim] start auto play:"+g._wxcontent.mediaid,g),this.playAudioMessage(g._wxcontent.mediaid,function(t,o){t!=yim.YIMErrorcode.YIMErrorcode_Success&&(yim.debug&&console.warn("yim play error:",o),e.eventHandle.trigger("voicerecord.cancel",{localId:null,curPlayMsg:g}))})))};this.addToAutoPlayVoiceQueue=function(e){var t=e.content;if("string"==typeof t&&(t="{"==t.charAt(0)?JSON.parse(t):{}),e._wxcontent=t,!e._wxcontent.mediaid)return void console.error("[autovoice] msg content error!",e);s.push(e),yim.debug&&console.log("[yim] [autovoice] add msg to play queue!",e),s.length>200&&s.splice(0,50),E.call(this)},this.initAutoPlayVoiceQueue=function(e){e=e||{};var t=this;t.initAutoPlayVoiceQueue=function(){},t.eventHandle.on("voicerecord.beforestart",function(e){clearTimeout(w);var o=c;c="recording","playing"==o&&S.call(t,T)}),t.eventHandle.on("voicerecord.stop, voicerecord.cancel",function(e){c="",T="",clearTimeout(w),w=setTimeout(function(){E.call(t)},500)}),t.eventHandle.on("voiceplay.start",function(o){c="playing",T=o.localId,o.curPlayMsg&&e.beginPlay&&e.beginPlay.call(t,o.curPlayMsg)});var o=function(o){return"recording"!=c&&(c="",T=""),e.endPlay&&g&&g._endtimer&&e.endPlay.call(t,g),g&&(clearTimeout(g._endtimer),g._endtimer=0),yim.debug&&console.log("[yim] [voiceplay] msg play end!",g),g};t.eventHandle.on("voiceplay.cancel, voiceplay.beforestop, voiceplay.beforepause",function(e){o(e.localId)}),t.eventHandle.on("voiceplay.stop",function(e){o(e.localId),clearTimeout(w),w=setTimeout(function(){E.call(t)},100)})},this.initWeixinRecord=function(e,t){var o=this;f.call(o,e,function(){wx.checkJsApi({jsApiList:["startRecord"],success:function(e){var i=yim.createEvent("ResultEvent",yim.YIMErrorcode.YIMErrorcode_Success,"ok!",{support:e.checkResult.startRecord});o._supportAudioMessage=e.checkResult.startRecord,t.call(o,o._supportAudioMessage,i)}})})}},yim.Record=function(){this.iOffset=0,this.baseBuffer=new ArrayBuffer(1024),this.dataView=new DataView(this.baseBuffer,this.iOffset),this.getResult=function(){return btoa(String.fromCharCode.apply(null,new Uint8Array(this.baseBuffer,0,this.iOffset)))},this.setUint8Data=function(e){this.dataView.setUint8(this.iOffset,e),this.iOffset++},this.setUint16Data=function(e){this.dataView.setUint16(this.iOffset,e),this.iOffset+=2},this.setUint32Data=function(e){this.dataView.setUint32(this.iOffset,e),this.iOffset+=4},this.setInt8Data=function(e){this.dataView.setInt8(this.iOffset,e),this.iOffset++},this.setInt16Data=function(e){this.dataView.setInt16(this.iOffset,e),this.iOffset+=2},this.setInt32Data=function(e){this.dataView.setInt32(this.iOffset,e),this.iOffset+=4},this.setStringData=function(e){var t=new TextEncoder("utf-8").encode(e);for(this.dataView.setUint16(this.iOffset,t.length+1),this.iOffset+=2,j=0;j<t.length;j++)this.dataView.setUint8(this.iOffset,t[j]),this.iOffset++;this.dataView.setUint8(this.iOffset,0),this.iOffset++}},yim.trieInstance=function(e){for(this.root={},this.root.childNodes={},i=0;i<e.length;i++){var t=e[i],o=this.root;for(j=0;j<t.length;j++){var r=t.charAt(j),n=o.childNodes[r];null==n&&(n={childNodes:{}},o.childNodes[r]=n),o=n}o.finish=1}this.GetFilterText=function(e,t){for(var o="",i=this.root,r=-1,n=0;n<e.length;){var a=e.charAt(n),s=i.childNodes[a];null!=s?(-1==r&&(r=n),i=s,1==i.finish&&(i=this.root,r=-1,o+=t),n++):-1!=r?(o+=e.charAt(r),n=r+1,r=-1,i=this.root):(o+=e.charAt(n),n++)}return-1!=r&&(o+=e.substr(r,e.length-r+1)),o}};
/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.4.2
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */
!function(){"use strict";function t(t){if(t)c[0]=c[16]=c[1]=c[2]=c[3]=c[4]=c[5]=c[6]=c[7]=c[8]=c[9]=c[10]=c[11]=c[12]=c[13]=c[14]=c[15]=0,this.blocks=c,this.buffer8=i;else if(n){var r=new ArrayBuffer(68);this.buffer8=new Uint8Array(r),this.blocks=new Uint32Array(r)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=0,this.finalized=this.hashed=!1,this.first=!0}var r="object"==typeof window?window:{},e=!r.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;e&&(r=global);var i,h=!r.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,s="function"==typeof define&&define.amd,n=!r.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,f="0123456789abcdef".split(""),o=[128,32768,8388608,-2147483648],a=[0,8,16,24],u=["hex","array","digest","buffer","arrayBuffer"],c=[];if(n){var p=new ArrayBuffer(68);i=new Uint8Array(p),c=new Uint32Array(p)}var d=function(r){return function(e){return new t(!0).update(e)[r]()}},y=function(){var r=d("hex");e&&(r=l(r)),r.create=function(){return new t},r.update=function(t){return r.create().update(t)};for(var i=0;i<u.length;++i){var h=u[i];r[h]=d(h)}return r},l=function(t){var r=require("crypto"),e=require("buffer").Buffer,i=function(i){if("string"==typeof i)return r.createHash("md5").update(i,"utf8").digest("hex");if(i.constructor===ArrayBuffer)i=new Uint8Array(i);else if(void 0===i.length)return t(i);return r.createHash("md5").update(new e(i)).digest("hex")};return i};t.prototype.update=function(t){if(!this.finalized){var e="string"!=typeof t;e&&t.constructor==r.ArrayBuffer&&(t=new Uint8Array(t));for(var i,h,s=0,f=t.length||0,o=this.blocks,u=this.buffer8;f>s;){if(this.hashed&&(this.hashed=!1,o[0]=o[16],o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),e)if(n)for(h=this.start;f>s&&64>h;++s)u[h++]=t[s];else for(h=this.start;f>s&&64>h;++s)o[h>>2]|=t[s]<<a[3&h++];else if(n)for(h=this.start;f>s&&64>h;++s)i=t.charCodeAt(s),128>i?u[h++]=i:2048>i?(u[h++]=192|i>>6,u[h++]=128|63&i):55296>i||i>=57344?(u[h++]=224|i>>12,u[h++]=128|i>>6&63,u[h++]=128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++s)),u[h++]=240|i>>18,u[h++]=128|i>>12&63,u[h++]=128|i>>6&63,u[h++]=128|63&i);else for(h=this.start;f>s&&64>h;++s)i=t.charCodeAt(s),128>i?o[h>>2]|=i<<a[3&h++]:2048>i?(o[h>>2]|=(192|i>>6)<<a[3&h++],o[h>>2]|=(128|63&i)<<a[3&h++]):55296>i||i>=57344?(o[h>>2]|=(224|i>>12)<<a[3&h++],o[h>>2]|=(128|i>>6&63)<<a[3&h++],o[h>>2]|=(128|63&i)<<a[3&h++]):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++s)),o[h>>2]|=(240|i>>18)<<a[3&h++],o[h>>2]|=(128|i>>12&63)<<a[3&h++],o[h>>2]|=(128|i>>6&63)<<a[3&h++],o[h>>2]|=(128|63&i)<<a[3&h++]);this.lastByteIndex=h,this.bytes+=h-this.start,h>=64?(this.start=h-64,this.hash(),this.hashed=!0):this.start=h}return this}},t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,r=this.lastByteIndex;t[r>>2]|=o[3&r],r>=56&&(this.hashed||this.hash(),t[0]=t[16],t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.bytes<<3,this.hash()}},t.prototype.hash=function(){var t,r,e,i,h,s,n=this.blocks;this.first?(t=n[0]-680876937,t=(t<<7|t>>>25)-271733879<<0,i=(-1732584194^2004318071&t)+n[1]-117830708,i=(i<<12|i>>>20)+t<<0,e=(-271733879^i&(-271733879^t))+n[2]-1126478375,e=(e<<17|e>>>15)+i<<0,r=(t^e&(i^t))+n[3]-1316259209,r=(r<<22|r>>>10)+e<<0):(t=this.h0,r=this.h1,e=this.h2,i=this.h3,t+=(i^r&(e^i))+n[0]-680876936,t=(t<<7|t>>>25)+r<<0,i+=(e^t&(r^e))+n[1]-389564586,i=(i<<12|i>>>20)+t<<0,e+=(r^i&(t^r))+n[2]+606105819,e=(e<<17|e>>>15)+i<<0,r+=(t^e&(i^t))+n[3]-1044525330,r=(r<<22|r>>>10)+e<<0),t+=(i^r&(e^i))+n[4]-176418897,t=(t<<7|t>>>25)+r<<0,i+=(e^t&(r^e))+n[5]+1200080426,i=(i<<12|i>>>20)+t<<0,e+=(r^i&(t^r))+n[6]-1473231341,e=(e<<17|e>>>15)+i<<0,r+=(t^e&(i^t))+n[7]-45705983,r=(r<<22|r>>>10)+e<<0,t+=(i^r&(e^i))+n[8]+1770035416,t=(t<<7|t>>>25)+r<<0,i+=(e^t&(r^e))+n[9]-1958414417,i=(i<<12|i>>>20)+t<<0,e+=(r^i&(t^r))+n[10]-42063,e=(e<<17|e>>>15)+i<<0,r+=(t^e&(i^t))+n[11]-1990404162,r=(r<<22|r>>>10)+e<<0,t+=(i^r&(e^i))+n[12]+1804603682,t=(t<<7|t>>>25)+r<<0,i+=(e^t&(r^e))+n[13]-40341101,i=(i<<12|i>>>20)+t<<0,e+=(r^i&(t^r))+n[14]-1502002290,e=(e<<17|e>>>15)+i<<0,r+=(t^e&(i^t))+n[15]+1236535329,r=(r<<22|r>>>10)+e<<0,t+=(e^i&(r^e))+n[1]-165796510,t=(t<<5|t>>>27)+r<<0,i+=(r^e&(t^r))+n[6]-1069501632,i=(i<<9|i>>>23)+t<<0,e+=(t^r&(i^t))+n[11]+643717713,e=(e<<14|e>>>18)+i<<0,r+=(i^t&(e^i))+n[0]-373897302,r=(r<<20|r>>>12)+e<<0,t+=(e^i&(r^e))+n[5]-701558691,t=(t<<5|t>>>27)+r<<0,i+=(r^e&(t^r))+n[10]+38016083,i=(i<<9|i>>>23)+t<<0,e+=(t^r&(i^t))+n[15]-660478335,e=(e<<14|e>>>18)+i<<0,r+=(i^t&(e^i))+n[4]-405537848,r=(r<<20|r>>>12)+e<<0,t+=(e^i&(r^e))+n[9]+568446438,t=(t<<5|t>>>27)+r<<0,i+=(r^e&(t^r))+n[14]-1019803690,i=(i<<9|i>>>23)+t<<0,e+=(t^r&(i^t))+n[3]-187363961,e=(e<<14|e>>>18)+i<<0,r+=(i^t&(e^i))+n[8]+1163531501,r=(r<<20|r>>>12)+e<<0,t+=(e^i&(r^e))+n[13]-1444681467,t=(t<<5|t>>>27)+r<<0,i+=(r^e&(t^r))+n[2]-51403784,i=(i<<9|i>>>23)+t<<0,e+=(t^r&(i^t))+n[7]+1735328473,e=(e<<14|e>>>18)+i<<0,r+=(i^t&(e^i))+n[12]-1926607734,r=(r<<20|r>>>12)+e<<0,h=r^e,t+=(h^i)+n[5]-378558,t=(t<<4|t>>>28)+r<<0,i+=(h^t)+n[8]-2022574463,i=(i<<11|i>>>21)+t<<0,s=i^t,e+=(s^r)+n[11]+1839030562,e=(e<<16|e>>>16)+i<<0,r+=(s^e)+n[14]-35309556,r=(r<<23|r>>>9)+e<<0,h=r^e,t+=(h^i)+n[1]-1530992060,t=(t<<4|t>>>28)+r<<0,i+=(h^t)+n[4]+1272893353,i=(i<<11|i>>>21)+t<<0,s=i^t,e+=(s^r)+n[7]-155497632,e=(e<<16|e>>>16)+i<<0,r+=(s^e)+n[10]-1094730640,r=(r<<23|r>>>9)+e<<0,h=r^e,t+=(h^i)+n[13]+681279174,t=(t<<4|t>>>28)+r<<0,i+=(h^t)+n[0]-358537222,i=(i<<11|i>>>21)+t<<0,s=i^t,e+=(s^r)+n[3]-722521979,e=(e<<16|e>>>16)+i<<0,r+=(s^e)+n[6]+76029189,r=(r<<23|r>>>9)+e<<0,h=r^e,t+=(h^i)+n[9]-640364487,t=(t<<4|t>>>28)+r<<0,i+=(h^t)+n[12]-421815835,i=(i<<11|i>>>21)+t<<0,s=i^t,e+=(s^r)+n[15]+530742520,e=(e<<16|e>>>16)+i<<0,r+=(s^e)+n[2]-995338651,r=(r<<23|r>>>9)+e<<0,t+=(e^(r|~i))+n[0]-198630844,t=(t<<6|t>>>26)+r<<0,i+=(r^(t|~e))+n[7]+1126891415,i=(i<<10|i>>>22)+t<<0,e+=(t^(i|~r))+n[14]-1416354905,e=(e<<15|e>>>17)+i<<0,r+=(i^(e|~t))+n[5]-57434055,r=(r<<21|r>>>11)+e<<0,t+=(e^(r|~i))+n[12]+1700485571,t=(t<<6|t>>>26)+r<<0,i+=(r^(t|~e))+n[3]-1894986606,i=(i<<10|i>>>22)+t<<0,e+=(t^(i|~r))+n[10]-1051523,e=(e<<15|e>>>17)+i<<0,r+=(i^(e|~t))+n[1]-2054922799,r=(r<<21|r>>>11)+e<<0,t+=(e^(r|~i))+n[8]+1873313359,t=(t<<6|t>>>26)+r<<0,i+=(r^(t|~e))+n[15]-30611744,i=(i<<10|i>>>22)+t<<0,e+=(t^(i|~r))+n[6]-1560198380,e=(e<<15|e>>>17)+i<<0,r+=(i^(e|~t))+n[13]+1309151649,r=(r<<21|r>>>11)+e<<0,t+=(e^(r|~i))+n[4]-145523070,t=(t<<6|t>>>26)+r<<0,i+=(r^(t|~e))+n[11]-1120210379,i=(i<<10|i>>>22)+t<<0,e+=(t^(i|~r))+n[2]+718787259,e=(e<<15|e>>>17)+i<<0,r+=(i^(e|~t))+n[9]-343485551,r=(r<<21|r>>>11)+e<<0,this.first?(this.h0=t+1732584193<<0,this.h1=r-271733879<<0,this.h2=e-1732584194<<0,this.h3=i+271733878<<0,this.first=!1):(this.h0=this.h0+t<<0,this.h1=this.h1+r<<0,this.h2=this.h2+e<<0,this.h3=this.h3+i<<0)},t.prototype.hex=function(){this.finalize();var t=this.h0,r=this.h1,e=this.h2,i=this.h3;return f[t>>4&15]+f[15&t]+f[t>>12&15]+f[t>>8&15]+f[t>>20&15]+f[t>>16&15]+f[t>>28&15]+f[t>>24&15]+f[r>>4&15]+f[15&r]+f[r>>12&15]+f[r>>8&15]+f[r>>20&15]+f[r>>16&15]+f[r>>28&15]+f[r>>24&15]+f[e>>4&15]+f[15&e]+f[e>>12&15]+f[e>>8&15]+f[e>>20&15]+f[e>>16&15]+f[e>>28&15]+f[e>>24&15]+f[i>>4&15]+f[15&i]+f[i>>12&15]+f[i>>8&15]+f[i>>20&15]+f[i>>16&15]+f[i>>28&15]+f[i>>24&15]},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var t=this.h0,r=this.h1,e=this.h2,i=this.h3;return[255&t,t>>8&255,t>>16&255,t>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&e,e>>8&255,e>>16&255,e>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255]},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(16),r=new Uint32Array(t);return r[0]=this.h0,r[1]=this.h1,r[2]=this.h2,r[3]=this.h3,t},t.prototype.buffer=t.prototype.arrayBuffer;var b=y();h?module.exports=b:(r.md5=b,s&&define(function(){return b}))}();
